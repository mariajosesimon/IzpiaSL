{% extends "base.html" %}
{% block title %}Obras{% endblock %}
{% block contenido %}

<body>

    <div class="container mx-auto py-4">

        <form action="" method="post" enctype="multipart/form-data">
            <div class="form-group">
                {{ form.csrf_token }}

                <div class="grid grid-cols-1 md:grid-cols-4 grid-row-1 gap-3 py-3 text-green-800 form-control">

                    <!--Mostramos el nombre de la obra-->
                    {{form.Nombre.label(class="font-bold")}}
                    {% if obr.idObra != None %}
                    <h1>{{obr.Nombre}}</h1>
                    <div class="font-bold">Nº Pedido: </div>
                    <h2>{{obr.NumeroPedido}} </h2>
                    
                    <div class="font-bold">Cliente: </div><h2>{{client.Empresa}}</h2>
 

                </div>

                    <!--Fin Mostramos el nombre de la obra-->

                    <div>
                        <!--aqui tenemos que meter los productos y su tabla con cantidades-->
                        <!--actual component start-->
                        <div x-data="setup()">
                            <ul class="flex justify-center items-center my-4">
                                <template x-for="(tab, index) in tabs" :key="index">
                                    <li class="cursor-pointer py-2 px-4 text-gray-500 border-b-8"
                                        :class="activeTab===index ? 'text-green-500 border-green-500' : ''"
                                        @click="activeTab = index" x-text="tab"></li>
                                </template>
                            </ul>

                            <div>

                                <div class="w-80 bg-white p-16 text-center mx-auto border">
                                    <div x-show="activeTab===0">

                                        <div class="list-group">
                                            <grid class="grid grid-flow-col grid-cols-2 grid-rows-1 ">
                                                <div class="text-green-800 font-bold">NOMBRE</div>
                                                <div class="text-green-800 font-bold">CANTIDAD</div>

                                            </grid>
                                            {%for ps in productosSeleccionados%}
                                            {%for p in products%}
                                            {%if ps.idProducto == p.idProducto %}
                                            <grid
                                                class="grid grid-flow-col grid-cols-2 grid place-items-center grid-rows-1 ">
                                                <div class="text-green-800 ">{{p.Nombre}}</div>
                                                <div class="text-green-800 ">{{ps[1]}}</div>

                                            </grid>
                                            {%endif%}
                                            {%endfor%}
                                            {%endfor%}
                                        </div>
                                        <!--Aqui tenemos que añadir una tabla para ir metiendo los productos. -->
                                        <form action="" method="post" enctype="multipart/form-data"
                                            id="formularioProductos">
                                            <div class="form-group">
                                                {{ form.csrf_token }}

                                                {{formularioProductos.idProducto.label(class="font-bold") }}
                                                {{formularioProductos.idProducto(class="form-control border
                                                border-green-200")}}
                                                {{formularioProductos.idObra.label(class="font-bold invisible") }}
                                                {{formularioProductos.idObra(class="form-control border border-green-200
                                                invisible")}}

                                                {{formularioProductos.Cantidad.label(class="font-bold") }}
                                                {{formularioProductos.Cantidad(class="form-control border
                                                border-green-200")}}
                                                {% for error in formularioProductos.Cantidad.errors %}
                                                <span style="color: red;">{{ error }}</span>
                                                {% endfor %}


                                                <div class="flex gap-4 justify-center border-t p-4">

                                                    {{formularioProductos.btn_add(class="bg-transparent
                                                    hover:bg-green-500 text-green-700
                                                    font-semibold hover:text-white py-2 px-4
                                                    border border-green-500 hover:border-transparent rounded")}}

                                                </div>

                                            </div>
                                        </form>
                                    </div>
                                    <div x-show="activeTab===1">
                                        <!--Aqui tenemos que añadir una tabla para ir metiendo las tareas. -->
                                        <div class="list-group">
                         
                                        {%for to in resultadoTareasObra%}
                                        

                                        <div class="rounded bg-grey-light w-64 p-2">
                                            <div class="flex justify-between py-1">
                                                <h3 class="text-sm">{{to[2]}}</h3>
                                            </div>
                                            <div class="text-sm mt-2">

                                                <div class="bg-white p-2 rounded mt-1 border-b border-grey">
                                                 {{to[0]}}
                                              </div>
                                              
                                                <div class="bg-white p-2 rounded mt-1 border-b border-grey ">
                                                 {{to[1]}}
                                                    
                                              </div>
                                             
                                            </div>
                                          </div>


                                        {%endfor%}


                                    </div>

                                </div>

                            </div>

                            <!--actual component end-->

                            <!--Muestra las pestañas-->
                            <script>
                                function setup() {
                                    return {
                                        activeTab: 0,
                                        tabs: [
                                            "Productos",
                                            "Tareas",
                                        ]
                                    };
                                };


                            </script>




                            <!--hasta aqui tenemos que meter los productos y su tabla con cantidades-->
                        </div>
                        {% else %}

                        {{form.Nombre (class="text-green-800 border border-green-200")}}

                        {% for error in form.Nombre.errors %}
                        <span style="color: red;">{{ error }}</span>
                        {% endfor %}

                        {{form.idEstado.label(class="font-bold ")}}
                        {{form.idEstado (class="text-green-800 border border-green-200")}}
                        {{form.idCliente.label(class="font-bold") }}
                        {{form.idCliente(class="form-control border border-green-200")}}
                        {{form.NumeroPedido.label(class="font-bold ")}}
                        {{form.NumeroPedido (class="text-green-800 border border-green-200")}}
                        {%endif%}


                    </div>
                </div>
                <!--BOTONES-->
                <div class="grid grid-flow-col grid-row-1 gap-2  m-2">
                    {{form.submit(class="bg-transparent
                    hover:bg-green-500 text-green-700
                    font-semibold hover:text-white py-2 px-4
                    border border-green-500 hover:border-transparent rounded")}}

                    {{form.btn_cancel(class="bg-transparent
                    hover:bg-green-500 text-green-700
                    font-semibold hover:text-white py-2 px-4
                    border border-green-500 hover:border-transparent rounded")}}

                </div>
        </form>
    </div>


</body>

{% endblock %}